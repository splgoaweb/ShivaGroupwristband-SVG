!function(s){function t(){var e=[],a=!0;return{isSaveToPop:function(t){if(void 0===t)return a;a=t,this.next()},push:function(t){e.push(t),this.next()},next:function(){var t;!a||"function"==typeof(t=e.shift())&&t()}}}var c,l="data-itemId",i=new t,o=new t;function u(){s("html, body").animate({scrollTop:s(".visualized-tabs-wrapper").offset().top-60},700)}function p(t){var e=s("#tabstrip li["+l+'="'+t+'"]').attr("aria-controls"),a=s("#"+e);a.find(".found-products-grid .loader").show();var i=addAntiForgeryToken();i.id=t,s.ajax({url:s(".visualized-tabs-wrapper").attr("data-getProductsForSourceTypeUrl"),type:"POST",data:i}).done(function(t){a.find(".found-products-grid .products-grid").html(t),"70"!==a.find("select.itemSourceType").val()&&!a.find("input.category-custom-collection").is(":checked")||s(".visualized-tabs-wrapper").trigger("customListProductsLoaded",{tabContent:a})}).always(function(){a.find(".found-products-grid .loader").hide(),s(".products-vary-by-acl-message").removeClass("hidden")})}function f(t){var e,i=s(".visualized-tabs-wrapper"),n=t.closest(".tab-content.k-content"),o=parseInt(t.val()),a=addAntiForgeryToken(),r=parseInt(n.find(".group-item-id").val())||0,d=s('#tabstrip .tabs-anchors li[aria-controls="'+n.attr("id")+'"]');a.itemId=r,a.sourceType=o,n.find(".custom-item-content, .found-products-grid .products-grid, .custom-list-add-products").empty(),0!==o?s.ajax({url:i.attr("data-sourceTypeChangeUrl"),type:"POST",data:a}).done(function(t){var e=n.find(".custom-item-content");e.html(t),n.find(".custom-list-add-products").empty();var a=e.find('.group-item-title[name="Title"]').val();a&&d.find(".k-link").text(a),10!==o&&20!==o&&30!==o&&35!==o&&70!==o||p(r),i.on("change",".itemEntityId, .itemSortMethod",function(){m(s(this))})}):(e=i.attr("data-defaultItemTitle")||"<No Title>",d.find(".k-link").text(e))}function a(t){var e,a=t.closest(".tab-content.k-content"),i=t.closest("form"),n=i.attr("action"),o=i.attr("method"),r=parseInt(a.find(".group-item-id").val())||0;isNaN(r)||0===r||(e=i.serialize(),e+="&save=save",s.ajax({url:n,type:o,data:e}).done(function(){i.find(".homepage-products-mappings-grid").data("kendoGrid").dataSource.read(),p(r)}))}function e(){var t,d=s(".visualized-tabs-wrapper");0!==(t=s("#tabstrip")).length&&(0<(c=t.kendoTabStrip({animation:{open:{effects:"fadeIn"}},select:u}).data("kendoTabStrip")).tabGroup.children().length&&c.activateTab("li:first"),s("#tabstrip ul.k-tabstrip-items").kendoSortable({filter:"li.k-item:not(#add-new-item-from-tabstrip-button)",axis:"x",container:"ul.k-tabstrip-items",hint:function(t){return s("<div id='sortable-tabs-hint' class='k-widget k-header k-tabstrip'><ul class='k-tabstrip-items k-reset'><li class='k-item k-state-active k-tab-on-top'>"+t.html()+"</li></ul></div>")},start:function(t){c.activateTab(t.item)},change:function(t){var e=c.tabGroup.children().eq(t.newIndex);t.oldIndex<t.newIndex?c.insertAfter(t.item,e):c.insertBefore(t.item,e),i.push(function(){var t=[];s("#tabstrip li.k-item["+l+"]").each(function(){t.push(s(this).attr(l))});var e=s(".categories-sortable-list .sortable.active"),a=addAntiForgeryToken();a.groupId=parseInt(s("#Id").val())||parseInt(e.attr("data-productgroupid"))||0,a.ids=t,i.isSaveToPop(!1),s.ajax({url:s(".visualized-tabs-wrapper").attr("data-reorderGroupItemsUrl"),type:"POST",data:a}).fail(function(t){}).always(function(){i.isSaveToPop(!0)})})}})),s(".add-new-group-item-button, #add-new-item-from-tabstrip-button").off("click"),d.off("change",".itemSourceType"),d.off("click",".remove-item"),d.off("change",".group-item-title"),d.off("change",".group-item-active-input"),d.off("change",".itemEntityId, .itemSortMethod"),d.off("click",'.custom-list-add-products .homepage-products-mappings-grid input[type="checkbox"]'),d.off("click",".found-products-grid .item-box .remove-button"),d.off("customListProductsLoaded"),s("#Store").off("change"),s(".add-new-group-item-button, #add-new-item-from-tabstrip-button").on("click",function(t){t.preventDefault(),c.disable(s("#add-new-item-from-tabstrip-button"));var e=s(".categories-sortable-list .sortable.active"),a=addAntiForgeryToken();a.groupId=parseInt(s("#Id").val())||parseInt(e.attr("data-productgroupid"))||0,a.categoryId=parseInt(e.attr("data-categoryid"))||0,s.ajax({url:d.attr("data-createGroupItemUrl"),type:"POST",data:a}).done(function(t){var e,a,i,n=s(t),o=n.find(".group-item-id"),r=o.val();null!=r&&(s(".add-new-group-item-button").addClass("hidden"),s(".no-product-items-available").addClass("hidden"),e=s("#add-new-item-from-tabstrip-button"),a=s(".add-new-item-tabstrip-content"),s("#tabstrip").show().find(a).before(n),c.insertBefore({text:o.attr("data-defaultTitle")},e),(i=e.prev()).attr(l,r),c.activateTab(i),2<c.tabGroup.children().length&&s(".drag-and-drop-items-info").removeClass("hidden"),u(),d.on("change",".itemEntityId, .itemSortMethod",function(){m(s(this))}),d.on("change",".itemSourceType",function(){f(s(this))}),c.enable(s("#add-new-item-from-tabstrip-button")))})}),d.on("click",".remove-item",function(t){t.preventDefault();var e,a=s(this),i=parseInt(a.attr(l));isNaN(i)||0===i||!1!==confirm("Are you sure ?")&&((e=addAntiForgeryToken()).id=i,s.ajax({url:d.attr("data-deleteGroupItemUrl"),type:"POST",data:e}).done(function(){var t=s("#tabstrip li").filter("["+l+'="'+i+'"]');c.remove(t),1===c.tabGroup.children().length?(s("#tabstrip").hide(),s(".add-new-group-item-button").removeClass("hidden"),s(".no-product-items-available").removeClass("hidden"),s(".products-vary-by-acl-message").addClass("hidden")):t.is(".k-state-active")&&c.activateTab("li:first"),c.tabGroup.children().length<=2&&s(".drag-and-drop-items-info").addClass("hidden")}))}),d.on("change",".group-item-title",function(){var t=s(this),e=t.val(),a=t.closest(".tab-content.k-content"),i=s('#tabstrip .tabs-anchors li[aria-controls="'+a.attr("id")+'"]'),n=a.find(".group-item-title"),o=a.find('input[name$="LanguageId"]'),r=addAntiForgeryToken();r.Id=parseInt(i.attr(l))||0,r.Title=n.filter('[name="Title"]').val(),n.each(function(){var t=s(this);r[t.attr("name")]=t.val()}),o.each(function(){var t=s(this);r[t.attr("name")]=t.val()}),""!==e&&i.find(".k-link").text(e),s.ajax({url:d.attr("data-titleChangeUrl"),type:"POST",data:r}).done(function(t){n.filter('[name="Title"]').val(t.title),i.find(".k-link").text(t.title)})}),d.on("change",".group-item-active-input",function(){var t=s(this),e=addAntiForgeryToken();e.Id=parseInt(t.attr(l))||0,e.Active=t.is(":checked"),s.ajax({url:d.attr("data-activeChangeUrl"),type:"POST",data:e})}),d.on("change",".category-custom-collection",function(){var e=s(this),t=addAntiForgeryToken(),a=parseInt(e.attr(l));t.Id=a||0,t.EnableCategoryCustomCollection=e.is(":checked");var i=e.closest(".tab-content.k-content");s.ajax({url:d.attr("data-enablecategorycustomcollectionurl"),type:"POST",data:t}).done(function(t){i.find(".custom-item-content").html(t),i.find(".custom-list-add-products").empty(),d.on("change",".itemEntityId, .itemSortMethod",function(){m(s(this))}),e.is(":checked")&&s.event.trigger({type:"initializeCustomCategoryMappingPanel"}),p(a)})}),d.on("change",".itemEntityId, .itemSortMethod",function(){m(s(this))}),d.on("change",".itemSourceType",function(){f(s(this))}),d.on("click",'.custom-list-add-products .homepage-products-mappings-grid input[type="checkbox"]',function(){var t,e=s(this);e.is(":checked")?a(e):(t=e).closest(".tab-content.k-content").find('.found-products-grid .item-box[data-productId="'+t.val()+'"] .remove-button').click()}),d.on("click",".found-products-grid .item-box .remove-button",function(){var t,e=s(this),a=e.closest(".tab-content.k-content"),i=parseInt(a.find(".group-item-id").val())||0,n=e.closest(".item-box"),o=parseInt(n.attr("data-productId"))||0;isNaN(i)||0===i||isNaN(o)||0===o||((t=addAntiForgeryToken()).id=i,t.productId=o,s.ajax({url:d.attr("data-deleteProductFromCustomListUrl"),type:"POST",data:t}).done(function(){n.remove(),a.find(".homepage-products-mappings-grid").data("kendoGrid").dataSource.read(),p(i)}))}),d.on("customListProductsLoaded",function(t,e){var a,i,n=e.tabContent;null!=n&&0!==n.length&&("70"!==n.find("select.itemSourceType").val()&&!n.find("input.category-custom-collection").is(":checked")||((a=n.find(".found-products-grid .products-grid")).hasClass("sortable-grid")&&a.kendoSortable("destroy"),a.addClass("sortable-grid"),(i=a.children(".item-box")).addClass("sortable removable"),i.prepend('<div class="remove-button">remove</div>'),n.find(".drag-and-drop-products-info").toggleClass("hidden",i.length<2),a.kendoSortable({filter:".item-box.sortable",container:a,hint:function(t){return t.clone().addClass("hint")},placeholder:function(){return'<div class="item-box sortable placeholder"><span>Drag and drop your product here</span></div>'},change:function(){o.push(function(){var t=[];n.find(".products-grid.sortable-grid .item-box.sortable").each(function(){t.push(s(this).attr("data-productId"))});var e=addAntiForgeryToken();e.itemId=parseInt(n.find(".group-item-id").val())||0,e.productIds=t,o.isSaveToPop(!1),s.ajax({url:d.attr("data-reorderProductsInCustomListUrl"),type:"POST",data:e}).fail(function(){}).always(function(){o.isSaveToPop(!0)})})}})))}),s("#Store").on("change",function(){var e=s(this).val();s(".searchStoreId").each(function(){var t=s(this);t.val(e),a(t)})}),s(".products-vary-by-acl-message").each(function(){var t=s(this);0<t.closest(".tab-content").find(".products-grid .item-box").length&&t.removeClass("hidden")})}var m=function(t){var e,a=s(".visualized-tabs-wrapper"),i=t.closest(".tab-content.k-content"),n=s('#tabstrip .tabs-anchors li[aria-controls="'+i.attr("id")+'"]'),o=parseInt(i.find(".group-item-id").val())||0,r=parseInt(i.find("select.itemEntityId").val())||0,d=parseInt(i.find("select.itemSortMethod").val())||0;0!==r?((e=addAntiForgeryToken()).Id=o,e.EntityId=r,e.SortMethod=d,s.ajax({url:a.attr("data-entityOrSortMethodChangeUrl"),type:"POST",data:e}).done(function(t){var e=t.title||a.attr("data-defaultItemTitle")||"<No Title>";n.find(".k-link").text(e),t.title&&i.find('[name="Title"]').val(t.title),p(o)})):i.find(".found-products-grid .products-grid").empty()};s(document).ready(function(){var t;e(),s(document).on("newProductGroupAddedEvent",e),t=parseInt(s("#NumberOfProductsPerItem").val())+1,s("head").append("<style> .products-grid .sortable:nth-child(n+"+t+") { opacity: 0.2; } </style>")})}(jQuery);